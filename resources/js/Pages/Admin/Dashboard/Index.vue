<template>
    <div class="d-flex flex-column-fluid container">
        <div class="d-lg-flex flex-row-fluid">
            <!---->
            <div class="content-wrapper flex-row-fluid">
                <div>
                    <div class="row">
                        <div class="col-xxl-5">
                            <div class="row">
                                <div class="col-xl-6">
                                    <div class="card card-custom bg-primary gutter-b" style="height: 200px">
                                        <div class="card-body">
                                            <span class="svg-icon svg-icon-3x svg-icon-white ml-n2"><svg version="1.1"
                                                    viewBox="0 0 24 24" height="24px" width="24px"
                                                    xmlns:xlink="http://www.w3.org/1999/xlink"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <title xmlns="http://www.w3.org/2000/svg">
                                                        Stockholm-icons / Layout
                                                        / Layout-4-blocks
                                                    </title>
                                                    <desc xmlns="http://www.w3.org/2000/svg">
                                                        Created with Sketch.
                                                    </desc>
                                                    <defs xmlns="http://www.w3.org/2000/svg"></defs>
                                                    <g xmlns="http://www.w3.org/2000/svg"
                                                        id="Stockholm-icons-/-Layout-/-Layout-4-blocks" stroke="none"
                                                        stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <rect id="bound" x="0" y="0" width="24" height="24"></rect>
                                                        <rect id="Rectangle-7" fill="#000000" x="4" y="4" width="7"
                                                            height="7" rx="1.5"></rect>
                                                        <path
                                                            d="M5.5,13 L9.5,13 C10.3284271,13 11,13.6715729 11,14.5 L11,18.5 C11,19.3284271 10.3284271,20 9.5,20 L5.5,20 C4.67157288,20 4,19.3284271 4,18.5 L4,14.5 C4,13.6715729 4.67157288,13 5.5,13 Z M14.5,4 L18.5,4 C19.3284271,4 20,4.67157288 20,5.5 L20,9.5 C20,10.3284271 19.3284271,11 18.5,11 L14.5,11 C13.6715729,11 13,10.3284271 13,9.5 L13,5.5 C13,4.67157288 13.6715729,4 14.5,4 Z M14.5,13 L18.5,13 C19.3284271,13 20,13.6715729 20,14.5 L20,18.5 C20,19.3284271 19.3284271,20 18.5,20 L14.5,20 C13.6715729,20 13,19.3284271 13,18.5 L13,14.5 C13,13.6715729 13.6715729,13 14.5,13 Z"
                                                            id="Combined-Shape" fill="#000000" opacity="0.3"></path>
                                                    </g>
                                                </svg></span>
                                            <div class="text-inverse-primary font-weight-bolder font-size-h2 mt-3 h3">
                                                {{ totalOffers }}
                                            </div>
                                            <a href="#"
                                                class="text-inverse-primary font-weight-bold font-size-lg mt-1 h3">
                                                Teklif</a>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-6">
                                    <div class="card card-custom gutter-b" style="height: 200px">
                                        <div class="card-body">
                                            <span class="svg-icon svg-icon-3x svg-icon-success"><svg version="1.1"
                                                    viewBox="0 0 24 24" height="24px" width="24px"
                                                    xmlns:xlink="http://www.w3.org/1999/xlink"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <!-- Generator: Sketch 50.2 (55047) - http://www.bohemiancoding.com/sketch -->
                                                    <title xmlns="http://www.w3.org/2000/svg">
                                                        Stockholm-icons /
                                                        Communication / Group
                                                    </title>
                                                    <desc xmlns="http://www.w3.org/2000/svg">
                                                        Created with Sketch.
                                                    </desc>
                                                    <defs xmlns="http://www.w3.org/2000/svg"></defs>
                                                    <g xmlns="http://www.w3.org/2000/svg"
                                                        id="Stockholm-icons-/-Communication-/-Group" stroke="none"
                                                        stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <polygon id="Shape" points="0 0 24 0 24 24 0 24"></polygon>
                                                        <path
                                                            d="M18,14 C16.3431458,14 15,12.6568542 15,11 C15,9.34314575 16.3431458,8 18,8 C19.6568542,8 21,9.34314575 21,11 C21,12.6568542 19.6568542,14 18,14 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z"
                                                            id="Combined-Shape" fill="#000000" fill-rule="nonzero"
                                                            opacity="0.3"></path>
                                                        <path
                                                            d="M17.6011961,15.0006174 C21.0077043,15.0378534 23.7891749,16.7601418 23.9984937,20.4 C24.0069246,20.5466056 23.9984937,21 23.4559499,21 L19.6,21 C19.6,18.7490654 18.8562935,16.6718327 17.6011961,15.0006174 Z M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z"
                                                            id="Combined-Shape" fill="#000000" fill-rule="nonzero">
                                                        </path>
                                                    </g>
                                                </svg></span>
                                            <div class="text-dark font-weight-bolder font-size-h2 mt-3 h3">
                                                {{ distinctOffersCount }}
                                            </div>
                                            <a href="#"
                                                class="text-muted text-hover-primary font-weight-bold font-size-lg mt-1 h3">Müşteri</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xl-12">
                                    <div class="card card-custom gutter-b mt-5" style="
                                            height: 200px;
                                            color: white;
                                            background-color: rgb(102, 50, 89);
                                            background-position: calc(
                                                    100% + 0.5rem
                                                )
                                                100%;
                                            background-size: 39%;
                                            background-image: url(backend/media/illustrations/rb_1451.png);
                                            background-repeat: no-repeat;
                                        ">
                                        <div class="card-body">
                                            <div class="font-weight-bolder text-white h4 mt-3">
                                                En Çok Tercih Edilen Marka
                                            </div>
                                            <span class="text-white h2">
                                                {{
                                                    mostPreferredBrand.brand_name
                                                }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3 d-flex aling-items-center justify-content-center">
                                <img src="backend/media/illustrations/rb_13223.png"
                                    style="max-width:300px !important; width:100%" />
                            </div>
                        </div>
                        <div class="col-xxl-7">
                            <div class="row mt-3 mb-3">
                                <div class="h2">
                                    Son 6 Ay İçin Tercih Edilen Marka Tipleri
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xl-12">
                                    <div class="card card-custom gutter-b">
                                        <div class="card-body">
                                            <apexchart type="bar" :options="chartOptions" :series="chartSeries"
                                                min-height="100px"></apexchart>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3 mb-3">
                        <div class="h2">En Çok Tercih Edilen Arabalar</div>
                    </div>
                    <div class="row g-5 mt-3">
                        <div class="col-sm-12 col-md-4 col-lg-4 d-flex" v-for="car in parsedModels"
                            :key="car.car_name">
                            <VehicleCard :key="car.car_name" :imgSrc="`https://dvdfilo.limonist.dev/uploads/${car.image}`"
                                :title="car.name.tr" :brand="car.brand_name" :desc="car.desc.tr"
                                :totalOffers="car.total" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
import AdminLayoutMaster from "@/Layouts/AdminLayouts/Master";
import InputError from "@/Components/InputError";
import VehicleCard from "@/Components/VehicleCard";
export default {
    name: "Index",
    components: { InputError, VehicleCard },
    props: [
        "totalOffers",
        "distinctOffersCount",
        "mostPreferredType",
        "mostPreferredBrand",
        "mostPreferredCar",
    ], // mostPreferredType prop'u burada geliyor
    layout: AdminLayoutMaster,
    methods: {},
    mounted() {
        // mostPreferredType verisini dinamik olarak chartSeries'e ekle
        if (this.mostPreferredType) {
            this.updateChartSeries();
        }
    },
    data() {
        return {
            chartOptions: {
                chart: {
                    id: "vuechart-example",
                },
                xaxis: {
                    categories: ["05", "06", "07", "08", "09", "10"], // Örnek kategoriler, bunları tarihlerle değiştirebilirsin
                },
                grid: {
                    strokeDashArray: 5, // Klavuz çizgilerini kesik yapmak için
                },
                stroke: {
                    curve: "smooth", // Eğer eğri bir çizgi isterseniz
                    width: 2,
                    // Burada çizgilerin kesik olmasını sağlıyoruz
                },
            },
            chartSeries: [], // Boş başlat, dinamik olarak güncellenecek
        };
    },
    methods: {
        updateChartSeries() {
            // mostPreferredType prop'undaki veriyi chartSeries'e aktar
            this.chartSeries = this.mostPreferredType.map((typeData) => {
                return {
                    name: typeData.name, // Örneğin 'Elektrikli', 'Lüks' gibi isimler
                    data: typeData.data, // İlgili ay verileri
                };
            });
        },
    },
    computed: {
        parsedModels() {
            return this.mostPreferredCar.map(project => {
                let name = {};
                let desc = {};

                // Safely parse name
                try {
                    name = JSON.parse(project.car_name) || {};
                } catch (e) {
                    console.error("Failed to parse name:", e);
                }

                // Safely parse desc
                try {
                    desc = JSON.parse(project.desc) || {};
                } catch (e) {
                    console.error("Failed to parse desc:", e);
                }

                // Safely parse price
           

                return {
                    ...project,
                    name,
                    desc,
            
                };
            });
        }
    }
};
</script>

<style scoped></style>
